<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />

<script src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="https://hammerjs.github.io/dist/hammer.min.js"></script>

<script>
  $(function () {
    // Remove the preview bar for dev work
    $('#preview-bar-container').remove();

    // Apply a class to the body tag so we can target specific pages
    var url = window.location.pathname;
    var page;

    switch (true) {
      case /^\/hc\/\D{2,5}$/gi.test(url): page = 'home'; break;
      case /^\/hc\/\D{2,5}\/categories/gi.test(url): page = 'category'; break;
      case /^\/hc\/\D{2,5}\/sections/gi.test(url): page = 'section'; break;
      case /^\/hc\/\D{2,5}\/articles/gi.test(url): page = 'article'; break;
    }

    $('body').addClass(page);

    // Remove the standard header on the homepage
    if ($('body').hasClass('home')) {
      $('body.home > header').remove();
    }

    // Move breadcrumbs to the top nav
    if ($('nav#breadcrumbs')) {
      var breadcrumbs = $('nav#breadcrumbs');
      
      $('nav#breadcrumbs').remove();
      $('header').append(breadcrumbs);
    }

    // On articles, add the article title to the breadcrumbs
    if ($('body').hasClass('article')) {
      var title = $('body.article h1').text();

      $('nav#breadcrumbs ol').append(`<li>${title}</li>`);
    }

    // Mobile search controls
    $('header #mobile-search, header .mobile-close').click(function () {
      $('header #search').toggleClass('show');
    });

    // Homepage mobile carousel
    if ($('body').hasClass('home')) {
      var hammertime = new Hammer(document.querySelector('body.home .featured-categories .categories'), {});

      var carousel = document.querySelector('#homepage .featured-categories .categories .treadmill');
      var catWidth = document.querySelector('body.home .featured-categories .categories .treadmill .category').offsetWidth;

      var carouselCount = 0;
      var carouselMax = carousel.children.length - 1;

      var scrollbar = $('#homepage .scrollbar');
      var scrollbarWidth = $('#homepage .scrollbar').width();
      var scrollbarThumbWidth = scrollbarWidth / (carouselMax + 1);

      $('#homepage .scrollbar-thumb').width(scrollbarThumbWidth);

      hammertime.on('swipeleft', function (ev) {
        if (carouselCount < carouselMax && $(window).width() < 768) {
          carouselCount++;
          carousel.style.left = `${-Math.abs((carouselCount * catWidth) - 25)}px`;

          $('#homepage .scrollbar-thumb').css('left', Math.abs(scrollbarThumbWidth * carouselCount));
        }
      });

      hammertime.on('swiperight', function (ev) {
        if (carouselCount > 0 && $(window).width() < 768) {
          carouselCount--;
          carousel.style.left = carouselCount === 0 ? `25px` : `${-Math.abs((carouselCount * catWidth) - 25)}px`;
          
          $('#homepage .scrollbar-thumb').css('left', Math.abs(scrollbarThumbWidth * carouselCount));
        }
      });
    }    
  });
</script>